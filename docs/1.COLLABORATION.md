# COLLABORATION GUIDE: n8n Mermaid Nodes Project

## Overview

This project is an n8n community node package designed to provide Mermaid diagram generation capabilities within n8n workflows. It extends n8n's functionality by adding custom nodes that can create, manipulate, and export Mermaid diagrams including flowcharts, sequence diagrams, Gantt charts, and other diagram types. The main use cases include automated documentation generation, workflow visualization, data flow diagrams, and dynamic chart creation based on workflow data.

---

## Project Structure & Responsibilities

```
/ (root)
â”œâ”€â”€ .editorconfig - Editor configuration for consistent code formatting
â”œâ”€â”€ .eslintrc.js - ESLint configuration for code quality and standards
â”œâ”€â”€ .eslintrc.prepublish.js - Specific ESLint rules for pre-publish validation
â”œâ”€â”€ .gitignore - Git ignore patterns for build artifacts and dependencies
â”œâ”€â”€ .npmignore - npm ignore patterns for package publishing
â”œâ”€â”€ .prettierrc.js - Prettier configuration for code formatting
â”œâ”€â”€ package.json - Project dependencies, scripts, and n8n node configuration
â”œâ”€â”€ tsconfig.json - TypeScript compiler configuration
â”œâ”€â”€ gulpfile.js - Gulp build tasks for copying icons and assets
â”œâ”€â”€ index.js - Main entry point for the n8n node package
â”‚
â”œâ”€â”€ credentials/ - Authentication and API credential definitions
â”‚   â”œâ”€â”€ ExampleCredentialsApi.credentials.ts - Example credential template
â”‚   â””â”€â”€ HttpBinApi.credentials.ts - HTTP Bin API credentials for testing
â”‚
â”œâ”€â”€ nodes/ - Custom n8n node implementations
â”‚   â”œâ”€â”€ ExampleNode/
â”‚   â”‚   â””â”€â”€ ExampleNode.node.ts - Example node template for reference
â”‚   â””â”€â”€ HttpBin/
â”‚       â”œâ”€â”€ HttpBin.node.ts - HTTP Bin node implementation
â”‚       â”œâ”€â”€ HttpBin.node.json - Node metadata and configuration
â”‚       â”œâ”€â”€ httpbin.svg - Node icon asset
â”‚       â””â”€â”€ HttpVerbDescription.ts - HTTP operation descriptions
â”‚
â”œâ”€â”€ .vscode/ - VS Code workspace configuration
â”œâ”€â”€ docs/ - Project documentation (including this file)
â””â”€â”€ .docs/ - AI templates and contribution guidelines
```

---

## Key Technologies

- **n8n**: Workflow automation platform - this project creates custom nodes that extend n8n's capabilities with Mermaid diagram generation
- **TypeScript**: Strongly-typed JavaScript for all node implementations, ensuring type safety and better development experience
- **Node.js**: Runtime environment (minimum version 20.15) for executing the custom nodes within n8n workflows
- **Mermaid**: Diagram and flowchart generation library (to be integrated) for creating various types of visual diagrams
- **Gulp**: Build automation tool for copying assets (icons, SVGs) to the distribution folder
- **ESLint**: Code linting and quality assurance with n8n-specific rules for node development
- **Prettier**: Code formatting for consistent style across the project

---

## Project Details: File & Directory Responsibilities

### n8n Custom Nodes

**Project Structure**
- `nodes/`: Contains all custom n8n node implementations for Mermaid functionality
- `credentials/`: Authentication mechanisms for external services that nodes may need to access
- `package.json`: Defines the n8n node package configuration, including which nodes and credentials are exposed
- `dist/`: Compiled JavaScript output directory (generated during build)

### Build & Development Tools

**Project Structure**
- `tsconfig.json`: TypeScript compilation settings optimized for n8n node development
- `gulpfile.js`: Asset copying tasks for icons and SVG files
- `eslintrc.js`: Code quality rules including n8n-specific linting for node development
- `.prettierrc.js`: Code formatting configuration

### Documentation & Configuration

**Project Structure**
- `docs/`: Project documentation and collaboration guides
- `.docs/`: AI templates and setup instructions for contributors
- `.vscode/`: VS Code specific settings for consistent development environment

## Tools

### Tool: n8n

**Requirements**
- Node.js version 20.15 or higher
- npm package manager
- Global installation of n8n: `npm install n8n -g`

**Configurations n8n**
- `package.json` n8n section: Defines which nodes and credentials are registered with n8n
- `nodes/*/node.ts`: Individual node implementations following n8n's INodeType interface
- `credentials/*.credentials.ts`: Credential definitions for external service authentication

### Tool: TypeScript

**Requirements**
- TypeScript compiler (included in devDependencies)
- Node.js types and n8n workflow types

**Configurations TypeScript**
- `tsconfig.json`: Compilation settings targeting ES2019 with CommonJS modules for n8n compatibility
- `dist/`: Output directory for compiled JavaScript files

### Tool: Gulp

**Requirements**
- Gulp CLI (included in devDependencies)
- Node.js file system access

**Configurations Gulp**
- `gulpfile.js`: Asset copying tasks for node icons and credential images

## Setup & Development

### Prerequisites

- Node.js (version 20.15 or higher)
- npm package manager
- git for version control
- n8n installed globally: `npm install n8n -g`
- Recommended: n8n development environment setup following official documentation

### Install Dependencies

```sh
npm install
```

### Development Workflow

```sh
# Watch mode for TypeScript compilation
npm run dev

# Build the project (compile TypeScript and copy assets)
npm run build

# Format code
npm run format

# Lint code
npm run lint

# Fix linting issues automatically
npm run lintfix
```

## Build & Deployment

### Build

- **TypeScript Compilation**: `npm run build` - Compiles TypeScript to JavaScript and copies icon assets
- **Development Mode**: `npm run dev` - Runs TypeScript compiler in watch mode for active development
- **Asset Processing**: Gulp automatically copies PNG/SVG icons from nodes and credentials to dist folder

### Deploy

Deploy for n8n community node registry:

```sh
# Prepare for publishing (build + lint)
npm run prepublishOnly

# Publish to npm registry
npm publish
```

For n8n cloud verification:
1. Ensure package is published to npm
2. Submit for verification through n8n's community node submission process
3. Follow n8n documentation for community node guidelines

## Debugging

### Debugging Strategy: Build error recovery

```sh
# Clean and rebuild
npx rimraf dist && npm run build

# Check for TypeScript errors
npx tsc --noEmit

# Validate n8n node structure
npm run lint
```

### Debugging Strategy: Node development

```sh
# Test node locally in n8n
n8n start

# Run with development credentials
n8n start --tunnel
```

**DEBUGGING: GOTCHAs AND RECOVERY**

- The ERROR: "Unexpected eof" (end of file) | Can typically mean there is a missing or extra bracket/parenthesis. However, can be some times caused by mis-aligned quote types (i.e. opening quote: \' while closing quote '") or additionally by missing tags. Please rewrite the given file to fix the error even if it looks correct. Mistakes happen.
- n8n Node Type Errors: Ensure INodeType interface is properly implemented with required description properties
- Credential Loading Issues: Verify credential files are properly exported and referenced in package.json n8n section
- Icon Display Problems: Check that SVG/PNG files are in correct directories and gulp build task copies them to dist
- TypeScript Import Errors: Use n8n-workflow imports correctly and ensure all required types are imported

## Git Commit Best Practices

**Git Commands**

- Use the `git status` command to get a clear view of what you are updating.
- Add and commit your changes with a helpful message using `git add -A && git commit -m '[HELPFUL COMMIT MESSAGE HERE]'`

**Basic Rules**
- Git commits should be a wrapper for related changes. For example, fixing two different bugs should produce two separate commits. 
- Commit Often to keep your commits small to enable better reporting on changes and git history management.
- Don't Commit Half-Done Work, only commit code when a logical component is completed. Split a feature's implementation into logical chunks that can be completed quickly so that you can commit often.
- Test Your Code Before You Commit. Follow the Debugging Strategies.
Resist the temptation to commit something that you Â«thinkÂ» is completed. Test it thoroughly by making sure the code builds.
- Write clear and Good Commit Messages and keep [.docs/CHANGELOG.md] is up to date. Begin your message with a short summary of your changes (up to 50 characters as a guideline). Separate it from the following body by including a blank line. The body of your message should provide detailed answers to the following questions: â€“ What was the motivation for the change? â€“ How does it differ from the previous implementation? Use the imperative, present tense (Â«changeÂ», not Â«changedÂ» or Â«changesÂ») to be consistent with generated messages from commands like git merge.

## Collaboration Tips

- Keep node implementations focused and single-purpose for better maintainability
- Use clear, descriptive names for node properties and operations
- Document new nodes, credentials, and operations in the `.docs/` folder
- Test nodes thoroughly in n8n before committing changes
- Follow n8n's community node guidelines for consistency
- Update this guide as the project evolves and new Mermaid features are added

## ğŸ”¬ğŸ“š Research

Find all the research docs related to this project in the directory [./.docs/research/].

**â€¼ï¸ Rules**

- âœ… Always provide link or path reference to resources used from this Research. Use Oxford Academic citing style, both inline and as a footnote.
- âœ… Always prefer research notes and documentation provided here over your own knowledge.

**ğŸ“ Notes**

A set of notes, as markdown files of research relating to topics relevant to this project can be found in [./.docs/research/note-*.md]. Reference these to inform implementations related to this project.

**ğŸŒ Confluence Page documents**

Contains a list of relevant [./.docs/research/confluence_pages.md] researched in this project following the template [./.docs/ai/templates/__confluence_pages.md].

**ğŸŒ Web link documents**

Contains a list of relevant [./.docs/research/web_links.md] researched in this project following the template [./.docs/ai/templates/__web_links.md].
